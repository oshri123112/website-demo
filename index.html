<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>טאבלט משטרתי</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #0d1117;
      color: #fff;
    }
    .login-screen, .tablet-screen {
      display: none;
      height: 100vh;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }
    .login-screen.active, .tablet-screen.active {
      display: flex;
    }
    .login-box {
      background: #161b22;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 10px #000;
      width: 300px;
    }
    .login-box h2 {
      margin-bottom: 20px;
      text-align: center;
    }
    .login-box input {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border: none;
      border-radius: 5px;
    }
    .login-box button {
      width: 100%;
      padding: 10px;
      background-color: #238636;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .tablet {
      background: #161b22;
      width: 90%;
      max-width: 800px;
      height: 90%;
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 0 20px #000;
      display: flex;
      flex-direction: column;
    }
    .nav {
      display: flex;
      justify-content: space-around;
      margin-bottom: 20px;
    }
    .nav button {
      flex: 1;
      margin: 0 5px;
      padding: 10px;
      border-radius: 10px;
      border: none;
      background-color: #238636;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
    .screen {
      flex: 1;
      overflow-y: auto;
      display: none;
      background: #0d1117;
      padding: 10px;
      border-radius: 10px;
    }
    .screen.active {
      display: block;
    }
    form input, form textarea {
      width: 100%;
      padding: 8px;
      margin: 5px 0;
      border: none;
      border-radius: 5px;
    }
    form button {
      background-color: #238636;
      padding: 10px;
      color: white;
      border: none;
      border-radius: 5px;
      margin-top: 10px;
      cursor: pointer;
    }
    .list-item {
      background: #21262d;
      padding: 10px;
      border-radius: 5px;
      margin: 5px 0;
    }
    .timestamp {
      font-size: 0.8em;
      color: #999;
    }
  </style>
</head>
<body>
<div class="login-screen active" id="loginScreen">
  <div class="login-box">
    <h2>התחברות למערכת</h2>
    <input type="password" id="passwordInput" placeholder="סיסמה" />
    <button onclick="login()">התחבר</button>
  </div>
</div>
<div class="tablet-screen" id="tabletScreen">
  <div class="tablet">
    <div class="nav">
      <button onclick="showScreen('registration')">רישום</button>
      <button onclick="showScreen('chase')">רדיפה</button>
      <button onclick="showScreen('backup')">גיבוי</button>
      <button onclick="showScreen('search')">בדיקה</button>
      <button onclick="showScreen('report')">דוח</button>
    </div>
    <div id="registration" class="screen active">
      <form onsubmit="submitForm(event, 'registration')">
        <input type="text" name="name" placeholder="שם מלא" required />
        <input type="text" name="unit" placeholder="יחידה" required />
        <button type="submit">שלח רישום</button>
      </form>
      <div id="registrationList"></div>
    </div>
    <div id="chase" class="screen">
      <form onsubmit="submitForm(event, 'chases')">
        <input type="text" name="suspect" placeholder="שם החשוד" required />
        <input type="text" name="vehicle" placeholder="רכב החשוד" required />
        <button type="submit">דווח על רדיפה</button>
      </form>
      <div id="chaseList"></div>
    </div>
    <div id="backup" class="screen">
      <form onsubmit="submitForm(event, 'backups')">
        <input type="text" name="location" placeholder="מיקום" required />
        <input type="text" name="reason" placeholder="סיבה" required />
        <button type="submit">בקש גיבוי</button>
      </form>
      <div id="backupList"></div>
    </div>
    <div id="search" class="screen">
      <form onsubmit="submitForm(event, 'searches')">
        <input type="text" name="query" placeholder="מה לבדוק?" required />
        <button type="submit">בדוק</button>
      </form>
      <div id="searchList"></div>
    </div>
    <div id="report" class="screen">
      <form onsubmit="submitForm(event, 'reports')">
        <textarea name="description" placeholder="פרטי הדוח" required></textarea>
        <button type="submit">שלח דוח</button>
      </form>
      <div id="reportList"></div>
    </div>
  </div>
</div>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAAADd1lL5cgTgTxQOC8VSrjLlIsDlRyIk",
    authDomain: "policereportsystem-f23fd.firebaseapp.com",
    projectId: "policereportsystem-f23fd",
    storageBucket: "policereportsystem-f23fd.appspot.com",
    messagingSenderId: "93022201022",
    appId: "1:93022201022:web:b33be966dcac2ce8612aef"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  function login() {
    const pass = document.getElementById('passwordInput').value;
    if (pass === "1234") {
      document.getElementById('loginScreen').classList.remove('active');
      document.getElementById('tabletScreen').classList.add('active');
    } else {
      alert("סיסמה שגויה");
    }
  }

  function showScreen(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  function submitForm(event, collection) {
    event.preventDefault();
    const form = event.target;
    const data = {};
    Array.from(form.elements).forEach(el => {
      if (el.name) data[el.name] = el.value;
    });
    data.timestamp = firebase.firestore.FieldValue.serverTimestamp();
    db.collection(collection).add(data).then(() => {
      form.reset();
    });
  }

  function renderList(collectionName, containerId, formatter) {
    db.collection(collectionName).orderBy('timestamp', 'desc').onSnapshot(snapshot => {
      const container = document.getElementById(containerId);
      container.innerHTML = '';
      if (snapshot.empty) {
        container.innerHTML = '<p>אין פריטים להצגה כרגע.</p>';
        return;
      }
      snapshot.forEach(doc => {
        const data = doc.data();
        const div = document.createElement('div');
        div.className = 'list-item';
        const ts = data.timestamp?.toDate().toLocaleString('he-IL') || '---';
        div.innerHTML = formatter(data, ts);
        container.appendChild(div);
      });
    });
  }

  renderList('registration', 'registrationList', (data, ts) => `
    <strong>שם:</strong> ${data.name} | <strong>יחידה:</strong> ${data.unit}
    <div class="timestamp">${ts}</div>
  `);
  renderList('chases', 'chaseList', (data, ts) => `
    <strong>חשוד:</strong> ${data.suspect} | <strong>רכב:</strong> ${data.vehicle}
    <div class="timestamp">${ts}</div>
  `);
  renderList('backups', 'backupList', (data, ts) => `
    <strong>מיקום:</strong> ${data.location} | <strong>סיבה:</strong> ${data.reason}
    <div class="timestamp">${ts}</div>
  `);
  renderList('searches', 'searchList', (data, ts) => `
    <strong>חיפוש:</strong> ${data.query}
    <div class="timestamp">${ts}</div>
  `);
  renderList('reports', 'reportList', (data, ts) => `
    <strong>דוח:</strong> ${data.description}
    <div class="timestamp">${ts}</div>
  `);
</script>
</body>
</html>
